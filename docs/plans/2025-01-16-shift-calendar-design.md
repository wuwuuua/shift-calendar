# 个人排班日历订阅系统 - 设计文档

## 项目概述

创建一个个人排班的 ICS 日历订阅项目，提供网页界面用于编辑排班，导出 .ics 文件后上传到 GitHub，支持 iPhone 通过订阅链接获取排班状态。

## 需求

- 网页日历视图，支持任意年份月份的查看和编辑
- 每个日期可选择四种排班状态：D(早班)、S(中班)、N(晚班)、R(休息)
- 数据保存在浏览器本地存储，刷新不丢失
- 导出 .ics 文件，可上传到 GitHub
- iPhone 可通过 GitHub 链接订阅日历

## 整体架构

**单页面应用 (SPA)**，纯客户端实现，无后端服务器。

### 核心组件

- **日历视图**：月份视图网格，显示每月所有日期，支持上下月切换和年月快速选择
- **排班编辑器**：点击日期弹出选择器，在 D/S/N/R 之间切换
- **工具栏**：包含月份导航、导出按钮
- **预览面板**：实时显示当月排班统计（各班次天数）

### 数据流

1. 用户在日历上点击日期 → 更新本地状态
2. 状态变化自动保存到浏览器 localStorage
3. 导出时，读取 localStorage 数据 → 生成 ICS 文件
4. 用户下载 .ics 文件并上传到 GitHub 仓库
5. iPhone 通过 GitHub raw 文件链接订阅日历

## 数据模型

### 排班数据结构

```javascript
{
  "2024-01-15": "D",  // 早班
  "2024-01-16": "S",  // 中班
  "2024-01-17": "N",  // 晚班
  "2024-01-18": "R"   // 休息
}
```

- 存储位置：`localStorage`，key 为 `shiftData`
- 以日期字符串（YYYY-MM-DD）作为键
- 班次代码作为值

### 班次配置

```javascript
const SHIFT_TYPES = {
  D: { label: '早班', color: '#3B82F6', time: '08:00-16:00' },
  S: { label: '中班', color: '#F59E0B', time: '16:00-24:00' },
  N: { label: '晚班', color: '#8B5CF6', time: '00:00-08:00' },
  R: { label: '休息', color: '#9CA3AF', time: '' }
}
```

### ICS 事件映射

每个排班日生成一个全天事件（VEVENT）：
- `SUMMARY`：标记班次类型
- `DESCRIPTION`：包含时间段信息

## 界面设计

### 页面布局（从上到下）

1. **标题栏**
   - 显示"个人排班日历"
   - 右侧：导出按钮

2. **导航栏**
   - 左侧：`< 上月` 按钮
   - 中间：年份下拉框 + 月份下拉框
   - 右侧：`下月 >` 按钮
   - 底部：返回今天按钮

3. **日历网格**
   - 周标题行：周日到周六（7列）
   - 日期格子：7列 x 5-6行
   - 每个格子显示：日期数字 + 班次标识（圆点/文字）
   - 不同班次用不同背景色区分
   - 鼠标悬停显示完整班次信息
   - 当前日期高亮边框

4. **统计栏**
   - 显示当月各班次天数统计
   - 格式：早班: 5天 | 中班: 6天 | 晚班: 5天 | 休息: 15天

5. **操作提示**
   - 页面底部说明
   - 文本："点击日期切换排班状态：D→S→N→R→无"

### 颜色方案

- 背景：白色 `#FFFFFF`
- 早班 D：蓝色 `#3B82F6`
- 中班 S：橙色 `#F59E0B`
- 晚班 N：紫色 `#8B5CF6`
- 休息 R：灰色 `#9CA3AF`
- 无排班：白色 `#FFFFFF`

## 技术栈

纯前端静态页面：

- **HTML5 + CSS3 + 原生 JavaScript**：无框架依赖，轻量简单
- **CSS Grid**：实现日历网格布局
- **Vanilla JS**：处理日期逻辑、localStorage、ICS 生成
- **FileSaver.js**：辅助下载 .ics 文件（可选）

## 项目结构

```
/
├── index.html          # 主页面
├── css/
│   └── style.css      # 样式文件
├── js/
│   ├── calendar.js    # 日历逻辑
│   ├── storage.js     # localStorage 操作
│   └── ics.js         # ICS 文件生成
└── README.md          # 使用说明
```

## ICS 文件生成

- 符合 RFC 5545 标准
- 每个排班日生成一个全天事件
- 设置事件的 `UID`、`DTSTART`、`DTEND`、`SUMMARY`、`DESCRIPTION`
- 导出文件名格式：`shift-calendar-YYYY-MM.ics`

## 部署方式

1. **本地开发**：直接用浏览器打开 `index.html`
2. **在线部署**：推送到 GitHub 仓库，启用 GitHub Pages
3. **iPhone 订阅**：使用 GitHub raw 文件链接或 GitHub Pages URL

## 设计决策

- ✅ 支持任意日期范围（年月选择器）
- ✅ 本地存储 + 可选导出
- ✅ 简洁现代的界面风格
- ❌ 无快速操作功能（用户反馈不需要）
